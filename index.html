<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Web Studio Pro ‚Äî Editor + Preview</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  :root {
    --bg:#0f1115; --bg2:#0c1118; --panel:#151922; --panel2:#0f141c;
    --accent:#3b82f6; --text:#e5e7eb; --muted:#94a3b8; --border:#232a36;
  }
  [data-theme="light"] {
    --bg:#f6f7fb; --bg2:#ffffff; --panel:#ffffff; --panel2:#f6f8fc;
    --accent:#2563eb; --text:#0f172a; --muted:#475569; --border:#e2e8f0;
  }
  * { box-sizing:border-box; }
  html, body { height:100%; margin:0; }
  body {
    background:var(--bg); color:var(--text);
    font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
  }
  .topbar {
    display:flex; align-items:center; gap:10px; padding:10px 12px;
    border-bottom:1px solid var(--border);
    background:linear-gradient(180deg, var(--panel2), var(--bg));
  }
  .brand { font-weight:700; }
  .toolbar { margin-left:auto; display:flex; gap:8px; flex-wrap:wrap; }
  button, .toggle, .inputlike {
    background:var(--panel); color:var(--text); border:1px solid var(--border);
    padding:7px 10px; border-radius:8px; cursor:pointer;
  }
  button:hover { border-color:#2c3544; background:rgba(59,130,246,.08); }
  .layout { position:absolute; top:52px; bottom:0; left:0; right:0; display:flex; min-height:0; }
  .sidebar {
    width:260px; min-width:180px; max-width:520px;
    display:flex; flex-direction:column; background:var(--panel2);
    border-right:1px solid var(--border);
    transition:width .15s ease;
  }
  .splitter-v { width:6px; cursor:col-resize; background:var(--bg2); border-left:1px solid var(--border); border-right:1px solid var(--border); }
  .center { flex:1; display:flex; min-width:0; }
  .editor-pane, .right-pane { display:flex; flex-direction:column; min-width:0; background:var(--panel2); }
  .editor-pane { flex:1; border-right:1px solid var(--border); }
  .right-pane { width:50%; min-width:280px; }
  .section-header {
    display:flex; align-items:center; justify-content:space-between; padding:8px 10px;
    border-bottom:1px solid var(--border); background:var(--panel);
  }
  .files { flex:1; overflow:auto; padding:6px; }
  .file { padding:6px 8px; border-radius:6px; cursor:pointer; display:flex; justify-content:space-between; }
  .file.active { background:rgba(59,130,246,.15); border:1px solid rgba(59,130,246,.35); }
  .file[data-ext="html"] .name { color:#e34c26; }
  .file[data-ext="css"] .name { color:#563d7c; }
  .file[data-ext="js"] .name { color:#f1e05a; }
  .file[data-ext="py"] .name { color:#3572A5; }
  #editor { width:100%; height:100%; }
  .right-inner { flex:1; display:flex; flex-direction:column; }
  #preview { flex:1; width:100%; border:0; background:var(--bg); }
  @media (max-width:900px) {
    .layout { flex-direction:column; }
    .sidebar { position:fixed; top:52px; bottom:0; left:0; z-index:20; width:80%; max-width:360px; transform:translateX(-100%); }
    .sidebar.show { transform:translateX(0); }
    .splitter-v { display:none; }
    .center { flex-direction:column; }
    .editor-pane { height:50vh; border-bottom:1px solid var(--border); }
    .right-pane { height:50vh; width:100%; }
  }
</style>
</head>
<body data-theme="dark">
  <div class="topbar">
    <button id="sidebarToggle">üìÅ</button>
    <div class="brand">Web Studio Pro</div>
    <div class="inputlike">Project: <span id="projName" contenteditable="true">My Project</span></div>
    <div class="toolbar">
      <button id="runBtn">‚ñ∂ Run</button>
      <button id="themeToggle">üåû/üåô</button>
      <button id="resetBtn">‚Ü∫ Reset</button>
    </div>
  </div>
  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="section-header">
        <div class="title">Files</div>
      </div>
      <div class="files" id="fileList"></div>
    </aside>
    <div class="splitter-v" id="splitLeft"></div>
    <div class="center">
      <section class="editor-pane">
        <div class="section-header"><div class="title">Editor</div></div>
        <div id="editor"></div>
      </section>
      <div class="splitter-v" id="splitRight"></div>
      <section class="right-pane">
        <div class="right-inner">
          <div class="section-header"><div class="title">Preview</div></div>
          <iframe id="preview" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
      </section>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/loader.min.js"></script>
  <script>
    const byId = id => document.getElementById(id);
    const extOf = n => (n.split('.').pop()||'').toLowerCase();
    const langOfExt = e => ({html:'html',css:'css',js:'javascript',py:'python'}[e]||'plaintext');
    let project = { name:'My Project', files:{'index.html':'<h1>Hello</h1>'}, active:'index.html', theme:'dark' };
    let editor, models = {};
    function refreshFilesUI(){
      const fl = byId('fileList'); fl.innerHTML='';
      Object.keys(project.files).forEach(name=>{
        const d=document.createElement('div'); d.className='file'+(project.active===name?' active':'');
        d.dataset.ext=extOf(name);
        d.innerHTML=`<span class="name">${name}</span>`;
        d.onclick=()=>openFile(name);
        fl.appendChild(d);
      });
    }
    function ensureModel(name){
      if(models[name]) return models[name];
      const m=monaco.editor.createModel(project.files[name]||'', langOfExt(extOf(name)), monaco.Uri.parse('inmemory:///'+name));
      m.onDidChangeContent(()=>{ project.files[name]=m.getValue(); });
      models[name]=m; return m;
    }
    function openFile(name){ project.active=name; editor.setModel(ensureModel(name)); refreshFilesUI(); }
    window.require.config({ paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs'} });
    window.require(['vs/editor/editor.main'], function(){
      Object.keys(project.files).forEach(ensureModel);
      editor=monaco.editor.create(byId('editor'),{
        model:models[project.active], theme:'vs-dark', automaticLayout:true,
        autoClosingBrackets:'always', autoClosingQuotes:'always'
      });
      monaco.languages.html.htmlDefaults.setOptions({ autoClosingTags:true });
      // Enter fix with ! shortcut
      editor.addCommand(monaco.KeyCode.Enter, ()=>{
                const model = editor.getModel();
        const pos = editor.getPosition();
        const line = model.getLineContent(pos.lineNumber);
        // Only insert boilerplate if line is exactly "!" and cursor is at end
        if (model.getLanguageId() === 'html' && line.trim() === '!' && pos.column === line.length + 1) {
          const range = new monaco.Range(pos.lineNumber, 1, pos.lineNumber, line.length + 1);
          model.pushEditOperations([], [{
            range,
            text: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>
<body>

</body>
</html>`
          }], () => null);
        } else {
          // Default Enter behaviour
          editor.trigger('keyboard', 'type', { text: '\n' });
        }
      });

      refreshFilesUI();
    });
    // Run: update preview iframe
    const iframe = byId('preview');
    function run() {
      const files = project.files;
      const htmlEntry = Object.keys(files).find(n => n.toLowerCase().endsWith('.html')) || 'index.html';
      const allCSS = Object.keys(files).filter(n => n.endsWith('.css')).map(n => files[n]).join('\n');
      const allJS  = Object.keys(files).filter(n => n.endsWith('.js')).map(n => files[n]).join('\n');
      const htmlBody = files[htmlEntry] || '';

      const doc = `
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>${allCSS}</style>
</head>
<body>
${htmlBody}
<script>
try {
${allJS}
} catch(e) { console.error(e); }
<\/script>
</body>
</html>`;
      iframe.srcdoc = doc;
    }

    // Buttons
    byId('runBtn').addEventListener('click', run);
    byId('themeToggle').addEventListener('click', () => {
      const th = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', th);
      monaco.editor.setTheme(th === 'dark' ? 'vs-dark' : 'vs-light');
      project.theme = th;
    });
    byId('resetBtn').addEventListener('click', () => {
      if (!confirm('Reset project?')) return;
      project = { name:'My Project', files:{'index.html':'<h1>Hello</h1>'}, active:'index.html', theme:project.theme };
      Object.values(models).forEach(m => m.dispose());
      models = {};
      Object.keys(project.files).forEach(ensureModel);
      openFile(project.active);
      run();
    });
    byId('sidebarToggle').addEventListener('click', () => {
      if (window.matchMedia('(max-width:900px)').matches) {
        byId('sidebar').classList.toggle('show');
      } else {
        byId('sidebar').classList.toggle('hidden');
      }
    });

    // Smooth resizing
    (function initSplitters(){
      const splitLeft = byId('splitLeft');
      const splitRight = byId('splitRight');
      const sidebar = byId('sidebar');
      const rightPane = document.querySelector('.right-pane');
      let dragV = null, frame = null, target = 0;

      const onMoveV = (e, side) => {
        if (side === 'left') {
          target = Math.min(Math.max(e.clientX, 140), window.innerWidth - 300);
          if (!frame) frame = requestAnimationFrame(() => {
            frame = null;
            sidebar.style.width = target + 'px';
          });
        } else {
          const rect = document.querySelector('.center').getBoundingClientRect();
          target = Math.min(Math.max(e.clientX - rect.left, 300), rect.width - 200);
          if (!frame) frame = requestAnimationFrame(() => {
            frame = null;
            rightPane.style.width = (document.querySelector('.center').clientWidth - target) + 'px';
          });
        }
      };

      splitLeft.addEventListener('mousedown', () => dragV = 'left');
      splitRight.addEventListener('mousedown', () => dragV = 'right');
      window.addEventListener('mousemove', e => { if (dragV) onMoveV(e, dragV); if (editor) editor.layout(); });
      window.addEventListener('mouseup', () => dragV = null);
    })();

    // Initial run
    run();
  </script>
</body>
</html>
